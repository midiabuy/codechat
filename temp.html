<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <h1>Websocket</h1>

  <form action="" id="instance-form">
    <label for="input-instance">Instance Name</label>
    <input type="text" id="input-instance">
    <button type="submit">Create Instance</button>
  </form>

  <div>
    <img src="" alt="" id="qrcode">
  </div>

  <script>
    const url = "http://localhost:8084/instance/create"
    const token = "zYzP7ocstxh3Sscefew4FZTCu4ehnM8v4hu"

    async function createInstance(instanceName) {
      await fetch(url, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${token}`,
          "apikey": token
        },
        body: JSON.stringify({ "instanceName": instanceName }),
      });

      await fetch(`http://localhost:8084/instance/connect/${instanceName}`, {
        method: "GET",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${token}`,
          "apikey": token
        },
      }).then(response => response.json())
        .then(data => {
          document.getElementById('qrcode').src = data.base64;
        })
    }

    document.getElementById("instance-form").addEventListener("submit", (event) => {
      event.preventDefault();
      const instanceName = document.getElementById("input-instance").value;
      createInstance(instanceName);
    })

  </script>

  <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
  <script>
    const socket = io("ws://127.0.0.1:8084");
    // let socket = new WebSocket("ws://127.0.0.1:3000");
    // console.log("Attempting Connection...");

    socket.on("connect", () => {
      console.log(socket.id); // x8WIv7-mJelg7on_ALbx
    });

    socket.on("disconnect", () => {
      console.log(socket.id); // undefined
    });

    // socket.onopen = () => {
    //     console.log("Successfully Connected");
    // };

    // socket.onmessage = event => {
    //     console.log("Received message:", event.data);
    //     displayMessage(event.data);
    // };

    // socket.onclose = event => {
    //     console.log("Socket Closed Connection: ", event);
    //     socket.send("Client Closed!");
    // };

    // socket.onerror = error => {
    //     console.log("Socket Error: ", error);
    // };

    // function displayMessage(message) {
    //     console.log(message);
    // }
</script>
  
</body>
</html>